<div class="row-fluid">
	<div class="span4 offset4">
		<div class="center">
			<h3 class="header small lighter blue">Manage Inventory</h3>
		</div>
	</div>
</div>

<br/>

<div class="row-fluid">
	<div class="span6 offset3">

		<div class="widget-box transparent">
			<div class="widget-header widget-header-flat">
				<h4 class="lighter">
					<i class="icon-cloud-upload"></i>
					Upload New Inventory
				</h4>
			</div>

			<div class="widget-body">
				<div class="widget-main no-padding">

					<br/>

					<div class="center">

						<% if params[:add_new_inventory_failed] %>
							<div class="alert alert-error">
								<button type="button" class="close" data-dismiss="alert">&times;</button>
								<strong>Error! </strong> There was an error with your upload!
							</div>
						<% end %>

						<div id="submitInventoryProgress" class="progress progress-success progress-striped active hide" data-percent="Uploading please wait...">
							<div class="bar" style="width:100%;"></div>
						</div>

						<%= form_for :location, :url => {:action => :inventory_upload, :controller => :locations} do |f| %>

							<%= f.hidden_field :id, :value => @location.id %>
							<%= f.file_field :file %>
							<button type="submit" onclick="uploadNewInventory();">Submit</button>

						<% end %>
					</div>

				</div>
			</div>

		</div>
		
	</div>
</div>

<% @inventories = Inventory.where(:location_id => @location.id, :active => true) %>

<% unless @inventories.count == 0 %>

	<% @cur_inventory = @inventories.where(:current => true).first %>

	<div class="row-fluid">
		<div class="span6 offset3">

			<div class="widget-box transparent">
				<div class="widget-header widget-header-flat">
					<h4 class="lighter">
						<i class="icon-folder-close"></i>
						Current Inventory
					</h4>
				</div>

				<div class="widget-body">
					<div class="widget-main no-padding">

						<table class="table table-bordered table-striped">

							<thead class="thin-border-bottom">
								<tr>
									<th>File Name</th>
									<th>File Size</th>
									<th>Date Added</th>
									<th>Total Views</th>
								</tr>
							</thead>

							<tbody>
								<tr>
									<td><a href="<%= location_inventory_view_url(:id => @location.id, :inv_id => @cur_inventory.id) %>" target="_blank"><%= @cur_inventory.file_file_name %></a></td>
									<% if (@cur_inventory.file_file_size / 1000) > 1000 %>
										<td><%= "%4.2f" % ((@cur_inventory.file_file_size / 1000.0) / 1000.0) %> MB</td>
									<% else %>
										<td><%= "%10.2f" % (@cur_inventory.file_file_size / 1000.to_f) %> KB</td>
									<% end %>
									<td><%= @cur_inventory.created_at.strftime("%b %e, %Y - %l:%M%P") %></td>
									<td><%= @cur_inventory.num_views.to_s %></td>
								</tr>
							</tbody>

						</table>

					</div>
				</div>

			</div>

		</div>
	</div>

	<br/><br/>

	<% if @inventories.count > 1 %>
		<div class="row-fluid">
			<div class="span6 offset3">
				<div class="widget-box transparent">
					<div class="widget-header widget-header-flat">
						<h4 class="lighter">
							<i class="icon-inbox"></i>
							Previous Inventories
						</h4>
					</div>

					<div class="widget-body">
						<div class="widget-main no-padding">

							<table class="table table-bordered table-striped">

								<thead class="thin-border-bottom">
									<tr>
										<th>File Name</th>
										<th>File Size</th>
										<th>Date Added</th>
										<th>Total Views</th>
									</tr>
								</thead>

								<tbody>
									<% @inventories.where(:current => false).order('id DESC').each do |inv| %>
										<tr>
											<td><a href="<%= location_inventory_view_url(:id => @location.id, :inv_id => inv.id) %>" target="_blank"><%= inv.file_file_name %></a></td>
											<% if (inv.file_file_size / 1000) > 1000 %>
												<td><%= "%4.2f" % ((inv.file_file_size / 1000.0) / 1000.0) %> MB</td>
											<% else %>
												<td><%= "%10.2f" % (inv.file_file_size / 1000.to_f) %> KB</td>
											<% end %>
											<td><%= inv.created_at.strftime("%b %e, %Y - %l:%M%P") %></td>
											<td><%= inv.num_views.to_s %></td>
										</tr>
									<% end %>
								</tbody>

							</table>

						</div>
					</div>

				</div>
			</div>
		</div>
	<% end %>

<% end %>

<!-- Unsubscribe from Inventory Management -->
<div class="row-fluid">
	<div class="span6 offset3">

		<br/><br/><br/>

		<div class="widget-box transparent">
			<div class="widget-header widget-header-flat">
				<h4 class="lighter">
					<i class="icon-remove-circle"></i>
					Unsubscribe
				</h4>
			</div>

			<div class="widget-body">
				<div class="widget-main no-padding">

					<div class="center">

						<a href="#" class="btn btn-danger btn-block">Unsubscribe</a>

					</div>

				</div>
			</div>

		</div>

	</div>
</div>



<script>
	$(applyPopovers());

	function uploadNewInventory(){

		// Show progress bar
		$( "#submitInventoryProgress" ).show();
	}
</script>